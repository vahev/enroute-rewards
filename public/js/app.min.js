firebase.initializeApp({apiKey:"AIzaSyBebYtKOqOxENgVbTfiNhWAxh4cr_Vn7Ec",authDomain:"rewards-cee1a.firebaseapp.com",databaseURL:"https://rewards-cee1a.firebaseio.com",projectId:"rewards-cee1a",storageBucket:"rewards-cee1a.appspot.com",messagingSenderId:"376174432289"});const app=angular.module("rewards",["ngSanitize"]),emoji=new EmojiConvertor;if(emoji.replace_mode="img",app.filter("emojis",["$sce",function(e){return r=>{const a=emoji.replace_colons(r);return a!==r?e.trustAsHtml(a):""}}]),app.filter("length",function(){return function(e){return Object.keys(e||{}).length}}),app.factory("emojiService",[()=>({replace_mode:emoji.replace_mode})]),"rewards.io"===window.location.hostname){const e="4201";var livereload=document.createElement("script");livereload.setAttribute("src","http://127.0.0.1:"+e+"/livereload.js"),document.head.appendChild(livereload)}app.controller("LeaderboardController",["$scope","$log","leaderboardService","configService","emojiService",(e,r,a,t,l)=>{const o=["image_1024","image_512","image_original"];e.emoji=l,e.config=t,e.fetchLeaderboard=(()=>{a.getValid().then(r=>{e.leaderboard=r.data})}),e.hasImage=(e=>Object.keys(e).some(e=>o.indexOf(e)>0)),e.getImage=(e=>{let r="";return o.forEach(a=>{void 0!==e[a]&&(r=e[a])}),r}),e.fetchLeaderboard()}]),app.controller("RewardsController",["$scope","$log","rewardsService","emojiService",(e,r,a,t)=>{e.emoji=t,e.fetchRewards=(()=>{e.newReward=null,a.getAll().then(r=>{e.newReward=angular.copy(a.reward({name:"New Reward"})),e.rewards=r.data})}),e.fetchRewards()}]),app.directive("rewardCard",()=>({controller:["$log","$scope","rewardsService","configService",(e,r,a,t)=>{r.config=t,r.updating=!1,r.uploading=!1,r.reward&&!r.isNew||(r.reward=a.reward({name:"New Reward"}),r.btnMessage="New");let l=angular.copy(r.reward);r.reward.image&&a.getImageUrl(r.reward.image).then(e=>{r.imageURL=e,r.$apply()}).catch(()=>{r.imageURL=null,r.$apply()}).finally(()=>{r.imageLoaded=!0,r.$apply()}),r.save=(()=>{r.updating=!0,r.uploading=!0;let{key:e}=r;r.isNew&&(e=null),a.update(e,r.reward,r.changedProperties()).then(()=>{l=angular.copy(r.reward)}).finally(()=>{r.isNew&&"function"==typeof r.onNew&&r.onNew(),r.uploading=!1,r.updating=!1,r.cancel(),r.$apply()})}),r.edit=(()=>{r.updating=!0}),r.cancel=(()=>{r.reward=angular.copy(l),r.updating=!1}),r.remove=(()=>{a.remove(r.key).then(()=>{"function"==typeof r.onRemove&&r.onRemove()})});const o=["detail","image","name","price"];r.changedProperties=(()=>o.filter(e=>void 0===o[e]&&void 0!==r.reward[e]).filter(e=>l[e]!==r.reward[e]).filter(e=>"object"!=typeof r.reward[e]||null!==r.reward[e])),r.hasChanged=(()=>r.changedProperties().length>0),r.$watch(()=>r.reward.image,(e,a)=>{void 0===e||null===e||void 0!==a&&null!==a||r.edit(),void 0!==e&&null!==e||void 0===a||null===a||r.cancel()})}],restrict:"E",scope:{isNew:"=?",key:"=?",onNew:"&?",onRemove:"&?",reward:"=?"},templateUrl:"/templates/rewardCard.html"})),app.directive("storageImage",()=>({controller:["$log","$scope","$element","rewardsService",(e,r,a,t)=>{r.loaded=!1,r.src=r.url,r.load=(()=>{t.getImageUrl(r.url).then(e=>{r.image_url=e,r.$apply()}).catch(()=>{r.image_url=null,r.$apply()}).finally(()=>{r.loaded=!0,r.$apply()})}),r.$watch(()=>r.url,e=>{e&&"string"==typeof e&&r.load()}),r.load()}],restrict:"E",scope:{url:"="},templateUrl:"/templates/storageImage.html"})),app.directive("uploadFile",()=>({controller:["$log","$scope","$element","rewardsService",(e,r,a)=>{r.previewUrl=null,r.previewName=null,r.preview=!1;const t=angular.copy(r.url);r.setImage=(e=>{r.previewUrl=e,r.preview=!0,r.$apply()}),r.cancel=(()=>{r.previewUrl=null,r.previewName=null,r.preview=!1,r.url=void 0!==t?t:null,angular.element(a.find("input")).val("")}),r.processFile=(e=>{if(1!=e.files.length)return;var a=new FileReader;a.onload=function(e){r.setImage(e.target.result)};const[t]=e.files;a.readAsDataURL(t),r.previewName=t.name,r.url=t,r.$apply()}),r.$watch("url",e=>{void 0!==e&&null!==e||r.cancel()})}],restrict:"E",scope:{url:"="},templateUrl:"/templates/uploadFile.html"})),app.factory("configService",[()=>({title:"Enroute Rewards",keyword:{token:":taco:",singular:"taco",plural:"tacos"}})]);const LEADERBOARD_ENDPOINT="/leaderboard/";app.factory("leaderboardService",["$log","$http",(e,r)=>({get:e=>r.get(`/leaderboard//${e}`),getAll:()=>r.get("/leaderboard/all"),getValid:()=>r.get("/leaderboard/valid")})]);const REWARDS_ENDPOINT="/rewards/";app.factory("rewardsService",["$log","$http",(e,r)=>({get:e=>r.get(`/rewards//${e}`),getAll:()=>r.get("/rewards/all"),getImageUrl:e=>firebase.storage().ref().child(e).getDownloadURL(),remove:e=>r.delete(`/rewards/delete/${e}`),reward:e=>{return new function(e){Object.assign(this,e)}(e)},update:(a,t,l)=>{e.log("changes",l);const o=firebase.storage();if(t.key=a,l.indexOf("image")>-1){const e=`images/rewards/${Number(new Date)}-${t.image.name}`,a=o.ref().child(e);return new Promise(function(l,o){a.put(t.image).then(()=>{t.image=e,l(r.post("/rewards/update",t))}).catch(e=>{o(e)})})}return r.post("/rewards/update",t)}})]);